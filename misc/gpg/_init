#!/usr/bin/env zsh
source ${0:A:h}/../../deploy

install() {

  case $(_os) in
  debian) brew install gnupg ;;
  macos)
    brew install gnupg pinentry-mac
    ;;
  esac
}

# update() {}

link() {
  rm -f $HOME/.gnupg/gpg-agent.conf
  cat <<EOF >$HOME/.gnupg/gpg-agent.conf
default-cache-ttl 604800
max-cache-ttl 604800
enable-ssh-support
allow-loopback-pinentry
EOF
  case $(_os) in
  debian)
    #     cat <<EOF >>$HOME/.gnupg/gpg-agent.conf
    # pinetry-program /usr/bin/pinentry
    # EOF
    ;;
  macos)
    cat <<EOF >>$HOME/.gnupg/gpg-agent.conf
pinentry-program /usr/local/bin/pinentry-mac
EOF
    ;;
  esac
  gpgconf --reload gpg-agent
}

# clean() {}

init "$@"
